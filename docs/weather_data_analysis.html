<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Sun, Adam" />

<meta name="date" content="2020-02-22" />

<title>SCB_Global_Temps</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SCBs_Exploration</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/acloudysun12/SCBs_Exploration">
    <span class="fa fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">SCB_Global_Temps</h1>
<h4 class="author"><em>Sun, Adam</em></h4>
<h4 class="date"><em>February 22, 2020</em></h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-03-06
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>SCBs_Exploration/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.4.0). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20200222code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20200222)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20200222code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20200222)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomacloudysun12SCBsExplorationtree378da5eca70b48eb72fbb1f83bd833a2c5a9a187targetblank378da5ea"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/acloudysun12/SCBs_Exploration/tree/378da5eca70b48eb72fbb1f83bd833a2c5a9a187" target="_blank">378da5e</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomacloudysun12SCBsExplorationtree378da5eca70b48eb72fbb1f83bd833a2c5a9a187targetblank378da5ea" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility. The version displayed above was the version of the Git repository at the time these results were generated. <br><br> Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
working directory clean
</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the R Markdown and HTML files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view them.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/378da5eca70b48eb72fbb1f83bd833a2c5a9a187/analysis/weather_data_analysis.Rmd" target="_blank">378da5e</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
<td>
initial analysis SCBs file
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/acloudysun12/SCBs_Exploration/6c380590584ed76d07833dff3136f8bceea4cc23/docs/weather_data_analysis.html" target="_blank">6c38059</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/0d6644f671362332d30027907d0cf6eb641609b9/analysis/weather_data_analysis.Rmd" target="_blank">0d6644f</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
<td>
initial file for SCBs analysis
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/acloudysun12/SCBs_Exploration/708785b0dcdf4c619ea3131ee313ea85ff6fec05/docs/weather_data_analysis.html" target="_blank">708785b</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/acloudysun12/SCBs_Exploration/255e23e9bdb82554292a15169fa8138b5b9f170c/docs/weather_data_analysis.html" target="_blank">255e23e</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/5053802ea1b6c5db11a325c2bce5290512ee749f/analysis/weather_data_analysis.Rmd" target="_blank">5053802</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
<td>
wflow_publish(files = “weather_data_analysis.Rmd”)
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/acloudysun12/SCBs_Exploration/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/weather_data_analysis.html" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/f370a3e530aec962644975d003d70c33de9c2ef9/analysis/weather_data_analysis.Rmd" target="_blank">f370a3e</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
<td>
initial analysis file
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/acloudysun12/SCBs_Exploration/dc0573929cc0da7e56113a6f09809537ce6fa277/docs/weather_data_analysis.html" target="_blank">dc05739</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-02-22
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/149c43348fc881a80e966c3f92d8b94117a97222/analysis/weather_data_analysis.Rmd" target="_blank">149c433</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-02-22
</td>
<td>
initial analysis file with updates to come
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="simulation" class="section level1">
<h1>Simulation</h1>
<div id="data-prep-and-smoothing" class="section level2">
<h2>Data prep and smoothing <br></h2>
<p>Notes: <br> - Consider annual mean temps, i.e. 1660 to 2019 has 360 data points. <br> - Estimate sigma_hat_sq by looking at residuals of <span class="math inline">\(X_i - \mu_k(i)\)</span>, where <span class="math inline">\(\mu_i\)</span> is based on local linear estimate approach with bandwidth <span class="math inline">\(k \in (\frac{1}{3}, \frac{1}{2})\)</span>, as per step (a) of 4.1: Implementation. <br></p>
<p>Q’s: <br> - Lowess in R uses “locally-weighted polynomial regression”. Can we assume these weights are correct? <br> - Should we consider annualized temps, i.e. taking mean of last 4 quarters but quarter over quarter? <br> (- Would we ever want equal weights instead of weights based on a kernel?) <br></p>
<pre class="r"><code>ce_temps_path = &quot;https://raw.githubusercontent.com/acloudysun12/SCBs_Exploration/master/data/ce_ssn_temp_mean_raw.txt&quot;
ce_temps = read.table(ce_temps_path, header = TRUE) # we essentially ignore 1659

colnames(ce_temps) = c(&quot;Year&quot;, &quot;Qtr1&quot;, &quot;Qtr2&quot;, &quot;Qtr3&quot;, &quot;Qtr4&quot;)

ce_temps_yr = rowMeans(ce_temps[,2:5], na.rm = TRUE)
df_temps_yr = cbind(ce_temps, ce_temps_yr) %&gt;% 
  select(Year, ce_temps_yr) %&gt;% rename(Temp = ce_temps_yr)
ce_temps_yr_ts = ts(ce_temps_yr, frequency = 1, start = 1660)

kn_1 = floor(length(ce_temps_yr_ts)^(1/3))
kn_2 = ceiling(length(ce_temps_yr_ts)^(1/2))

plot.ts(ce_temps_yr_ts, main = &quot;Temps with bandwidth smoothers for variance estimation&quot;, ylim = c(7, 11.5))
lines(lowess(ce_temps_yr_ts, f = kn_1/length(ce_temps_yr_ts)), lwd = 2, col = 2, lty = 2)
lines(lowess(ce_temps_yr_ts, f = kn_2/length(ce_temps_yr_ts)), lwd = 2, col = 4, lty = 2)
legend(&quot;topleft&quot;, legend = c(&quot;data&quot;, &quot;b = n^(1/3)&quot;, &quot;b = n^(1/2)&quot;), col = c(1, 2, 4), lty = c(1,2,2))</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-1-1">
Past versions of unnamed-chunk-1-1.png
</button>
</p>
<div id="fig-unnamed-chunk-1-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-1-1.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>temps_LL_1 = lowess(ce_temps_yr_ts, f = kn_1/length(ce_temps_yr_ts))
ce_resids_yr_ts_1 = ce_temps_yr_ts - temps_LL_1$y

temps_LL_2 = lowess(ce_temps_yr_ts, f = kn_2/length(ce_temps_yr_ts))
ce_resids_yr_ts_2 = ce_temps_yr_ts - temps_LL_2$y</code></pre>
<p><br></p>
</div>
<div id="estimating-hatsigma2-with-sdf" class="section level2">
<h2>Estimating <span class="math inline">\(\hat\sigma^2\)</span> with SDF <br></h2>
<p>Notes/Q’s: <br> - We use spectral density function to get estimate for <span class="math inline">\(\gamma(0)\)</span> aka <span class="math inline">\(\hat\sigma^2\)</span>. <br> - What smoothing should be used for periodogram? <br> - what type of smoothing for periodogram? Modified Daniell okay? Looked at no smoothing, modified.daniell.c(4,4) (0.03 bandwidth), and modified.daniell.c(18,18) (0.15 banwidth). Seems sigma_sq_hat estimate is similar across any smoothing. We pick the largest estimate. <br> - Estimate of sigma_sq_hat should be 2*(area of periodogram), since it’s calculated in range of <span class="math inline">\(w \in (0, 1/2)\)</span> but we want range <span class="math inline">\(w \in (-1/2, 1/2)\)</span>? <br> - Is my periodogram approach correct? Why is there mention of the spectral density function = <span class="math inline">\(\sigma^2/(2\pi)\)</span> in Part 5. oe this mean I shouldd multiply my periodogram estimate by <span class="math inline">\(2\pi\)</span>? <br> - Should we use periodogram appraoch for variance estimate? Or should we use one of the variance estimates provided in equation (25)?</p>
<pre class="r"><code># Note ce_resids_yr_ts_1 is not used for estimating sigma_sq_hat since ce_resids_yr_ts_2 bigger

smooth_1 = kernel(&quot;modified.daniell&quot;, c(4,4))
round(1/(sum(smooth_1$coef^2) + sum(smooth_1$coef[-1]^2))/length(ce_temps_yr_ts), 3)</code></pre>
<pre><code>[1] 0.034</code></pre>
<pre class="r"><code>smooth_2 = kernel(&quot;modified.daniell&quot;, c(18,18))
round(1/(sum(smooth_2$coef^2) + sum(smooth_2$coef[-1]^2))/length(ce_temps_yr_ts), 3)</code></pre>
<pre><code>[1] 0.15</code></pre>
<pre class="r"><code>Iw_smooth_0 = mvspec(ce_resids_yr_ts_2, log = &quot;no&quot;) # this uses no smoothing of periodogram</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-2-1">
Past versions of unnamed-chunk-2-1.png
</button>
</p>
<div id="fig-unnamed-chunk-2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-2-1.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>Iw_smooth_1 = mvspec(ce_resids_yr_ts_2, kernel = smooth_1, log = &quot;no&quot;) # this uses modified Daniell</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-2-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-2-2">
Past versions of unnamed-chunk-2-2.png
</button>
</p>
<div id="fig-unnamed-chunk-2-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-2-2.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>Iw_smooth_2 = mvspec(ce_resids_yr_ts_2, kernel = smooth_2, log = &quot;no&quot;) # this uses modified Daniell</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-2-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-2-3">
Past versions of unnamed-chunk-2-3.png
</button>
</p>
<div id="fig-unnamed-chunk-2-3" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-2-3.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>sig_sq_hat_0 = 2*sum(Iw_smooth_0$freq[1] * Iw_smooth_0$spec) 
sig_sq_hat_0</code></pre>
<pre><code>[1] 0.2893024</code></pre>
<pre class="r"><code>sig_sq_hat_1 = 2*sum(Iw_smooth_1$freq[1] * Iw_smooth_1$spec) 
sig_sq_hat_1</code></pre>
<pre><code>[1] 0.2896925</code></pre>
<pre class="r"><code>sig_sq_hat_2 = 2*sum(Iw_smooth_2$freq[1] * Iw_smooth_2$spec) 
sig_sq_hat_2</code></pre>
<pre><code>[1] 0.2898102</code></pre>
<p>** <span class="math inline">\(\hat\sigma^2\)</span> without smoothing: 0.289 ** <br> ** <span class="math inline">\(\hat\sigma^2\)</span> with modified Daniell(4,4): 0.289 ** <br> ** <span class="math inline">\(\hat\sigma^2\)</span> with modified Daniell(18,18): 0.289 ** <br></p>
<p><br></p>
</div>
<div id="getting-optimal-bandwidth-for-mu" class="section level2">
<h2>Getting optimal bandwidth for <span class="math inline">\(\mu\)</span> <br></h2>
<p>Notes/Q’s: <br> - Not sure how to calculate Ruppert’s (1995) optimal bandwidth for MSE. <br> - Try a range of bandwidths as the optimal Ruppert bandwidth to see what results we get. <br> - Get variance correction factor (<span class="math inline">\(\hat\rho\)</span>) for each bandwidth based on step (a) of 4.1: Implementation. <br> - <span class="math inline">\(\nu\)</span> based on the sample variance of the errors (observed - fitted local linear estimate based on bandwidth) <br> - ** Final bandwidth based on <span class="math inline">\(2\hat\rho^{1/5}b_{Ruppert}\)</span>, trying different values for <span class="math inline">\(b_{Ruppert}\)</span>. ** <br> - Try to figure out Ruppert’s 1995 optimal bandwidth for MSE?</p>
<pre class="r"><code>b_ruppert_0 = 0.01
b_ruppert_1 = 0.02
b_ruppert_2 = 0.05
b_ruppert_3 = 0.10
b_ruppert_4 = 0.20

e_hats_0 = ce_temps_yr_ts -  (2*lowess(ce_temps_yr_ts, f = b_ruppert_0)$y -
  lowess(ce_temps_yr_ts, f = b_ruppert_0*sqrt(2))$y)
e_hats_1 = ce_temps_yr_ts -  (2*lowess(ce_temps_yr_ts, f = b_ruppert_1)$y -
  lowess(ce_temps_yr_ts, f = b_ruppert_1*sqrt(2))$y)
e_hats_2 = ce_temps_yr_ts -  (2*lowess(ce_temps_yr_ts, f = b_ruppert_2)$y -
  lowess(ce_temps_yr_ts, f = b_ruppert_2*sqrt(2))$y)
e_hats_3 = ce_temps_yr_ts -  (2*lowess(ce_temps_yr_ts, f = b_ruppert_3)$y -
  lowess(ce_temps_yr_ts, f = b_ruppert_3*sqrt(2))$y)
e_hats_4 = ce_temps_yr_ts -  (2*lowess(ce_temps_yr_ts, f = b_ruppert_4)$y -
  lowess(ce_temps_yr_ts, f = b_ruppert_4*sqrt(2))$y)

nu_0 = sum(e_hats_0^2)/length(ce_temps_yr_ts)
nu_1 = sum(e_hats_1^2)/length(ce_temps_yr_ts)
nu_2 = sum(e_hats_2^2)/length(ce_temps_yr_ts)
nu_3 = sum(e_hats_3^2)/length(ce_temps_yr_ts)
nu_4 = sum(e_hats_4^2)/length(ce_temps_yr_ts)
rho_hat_0 = sig_sq_hat_0/nu_0
rho_hat_1 = sig_sq_hat_0/nu_1
rho_hat_2 = sig_sq_hat_0/nu_2
rho_hat_3 = sig_sq_hat_0/nu_3
rho_hat_4 = sig_sq_hat_0/nu_4

b_final_0 = 2*(rho_hat_0)^(1/5)*b_ruppert_0
b_final_1 = 2*(rho_hat_1)^(1/5)*b_ruppert_1
b_final_2 = 2*(rho_hat_2)^(1/5)*b_ruppert_2
b_final_3 = 2*(rho_hat_3)^(1/5)*b_ruppert_3
b_final_4 = 2*(rho_hat_4)^(1/5)*b_ruppert_4</code></pre>
<p><br></p>
<p>** Final “optimal” bandwidths to try based on adjustments to Ruppert optimal bandwidth: 0.017, 0.042, 0.101, 0.197, 0.388. **</p>
<p><br></p>
</div>
<div id="simulations" class="section level2">
<h2>Simulations <br></h2>
<p>Notes/Q’s: <br> - Try all final bandwidths given the initial “optimal” bandwidths and following calculations of 4.1: Implementation. <br> - Try speeding up sim somehow?</p>
<pre class="r"><code>set.seed(9980)

years = time(ce_temps_yr_ts)

calc_suprem_rnorm = function(rand_iter, b_final){
  lowess_iter_b_1 = lowess(x = years, y = rand_iter, f = b_final)
  lowess_iter_b_2 = lowess(x = years, y = rand_iter, f = b_final*sqrt(2))
  return(mu_suprem = max(abs(2*lowess_iter_b_1$y - lowess_iter_b_2$y))) 
}

num_sims = 10000
rnorm_sims = matrix(rnorm(num_sims*length(ce_temps_yr_ts), 0 ,1), 
                    nrow = num_sims, ncol = length(ce_temps_yr_ts))

sup_mus_boot_0 = apply(rnorm_sims, MARGIN = 1, FUN = calc_suprem_rnorm, b_final = b_final_0)
sup_mus_boot_1 = apply(rnorm_sims, MARGIN = 1, FUN = calc_suprem_rnorm, b_final = b_final_1)
sup_mus_boot_2 = apply(rnorm_sims, MARGIN = 1, FUN = calc_suprem_rnorm, b_final = b_final_2)
sup_mus_boot_3 = apply(rnorm_sims, MARGIN = 1, FUN = calc_suprem_rnorm, b_final = b_final_3)
sup_mus_boot_4 = apply(rnorm_sims, MARGIN = 1, FUN = calc_suprem_rnorm, b_final = b_final_4)

interval_95_0 = quantile(sup_mus_boot_0, 0.95)*sqrt(sig_sq_hat_0)
interval_95_1 = quantile(sup_mus_boot_1, 0.95)*sqrt(sig_sq_hat_0)
interval_95_2 = quantile(sup_mus_boot_2, 0.95)*sqrt(sig_sq_hat_0)
interval_95_3 = quantile(sup_mus_boot_3, 0.95)*sqrt(sig_sq_hat_0)
interval_95_4 = quantile(sup_mus_boot_4, 0.95)*sqrt(sig_sq_hat_0)</code></pre>
<p><br></p>
</div>
<div id="putting-it-together" class="section level2">
<h2>Putting it together <br></h2>
<pre class="r"><code>ce_temps_tilde_0 = 2*lowess(ce_temps_yr_ts, f = b_final_0)$y - lowess(ce_temps_yr_ts, f = b_final_0*sqrt(2))$y
ce_temps_tilde_1 = 2*lowess(ce_temps_yr_ts, f = b_final_1)$y - lowess(ce_temps_yr_ts, f = b_final_1*sqrt(2))$y
ce_temps_tilde_2 = 2*lowess(ce_temps_yr_ts, f = b_final_2)$y - lowess(ce_temps_yr_ts, f = b_final_2*sqrt(2))$y
ce_temps_tilde_3 = 2*lowess(ce_temps_yr_ts, f = b_final_3)$y - lowess(ce_temps_yr_ts, f = b_final_3*sqrt(2))$y
ce_temps_tilde_4 = 2*lowess(ce_temps_yr_ts, f = b_final_4)$y - lowess(ce_temps_yr_ts, f = b_final_4*sqrt(2))$y

temps_UB_0 = ce_temps_tilde_0 + interval_95_0
temps_LB_0 = ce_temps_tilde_0 - interval_95_0
temps_UB_1 = ce_temps_tilde_1 + interval_95_1
temps_LB_1 = ce_temps_tilde_1 - interval_95_1
temps_UB_2 = ce_temps_tilde_2 + interval_95_2
temps_LB_2 = ce_temps_tilde_2 - interval_95_2
temps_UB_3 = ce_temps_tilde_3 + interval_95_3
temps_LB_3 = ce_temps_tilde_3 - interval_95_3
temps_UB_4 = ce_temps_tilde_4 + interval_95_4
temps_LB_4 = ce_temps_tilde_4 - interval_95_4</code></pre>
<p>** Empirical coverage rate with 95% SCB for bandwidth = 0.017 – 0.997 ** <br> ** Empirical coverage rate with 95% SCB for bandwidth = 0.042 – 0.931 ** <br> ** Empirical coverage rate with 95% SCB for bandwidth = 0.101 – 0.703 ** <br> ** Empirical coverage rate with 95% SCB for bandwidth = 0.197 – 0.553 ** <br> ** Empirical coverage rate with 95% SCB for bandwidth = 0.388 – 0.386 ** <br></p>
<p>Notes/Q’s: <br> - Why do empirical coverage rates seem quite low across most 95% SCBs? <br> - As bandwidths shorter, empirical coveragae better. <br> - Smallest bandwidth of 0.016 (around 6 years) has empirical coverage &gt; 95%, while rest of empirical coverage rates are worse. <br> - How short would Ruppert (1995) optimal bandwidth be? Even shorter than 0.02? <br> - Is our sigma estimated with spectral density and periodogram too low? Should we try use Equation (25) estimates of <span class="math inline">\(\sigma\)</span> instead? <br></p>
<p><br></p>
</div>
<div id="plots-with-scbs" class="section level2">
<h2>Plots with SCBs <br></h2>
<p>Notes/Q’s: <br> - For each bandwidth tried, we plot time series, local linear estimates, and their SCBs.</p>
<pre class="r"><code>plot(ce_temps_yr_ts, main = paste(&quot;Temps with LL est. and SCB for bandwidth:&quot;, round(b_final_0, 3)), 
     ylim = c(5, 13.5))
lines(as.numeric(years), ce_temps_tilde_0, lwd = 2, lty = 1, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_UB_0, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_LB_0, lwd = 2, lty = 2, col = &quot;coral&quot;)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-1">
Past versions of unnamed-chunk-6-1.png
</button>
</p>
<div id="fig-unnamed-chunk-6-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/6c380590584ed76d07833dff3136f8bceea4cc23/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-1.png" target="_blank">6c38059</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
</tr>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-1.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>plot(ce_temps_yr_ts, main = paste(&quot;Temps with LL est. and SCB for bandwidth:&quot;, round(b_final_1, 3)))
lines(as.numeric(years), ce_temps_tilde_1, lwd = 2, lty = 1, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_UB_1, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_LB_1, lwd = 2, lty = 2, col = &quot;coral&quot;)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-6-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-2">
Past versions of unnamed-chunk-6-2.png
</button>
</p>
<div id="fig-unnamed-chunk-6-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/6c380590584ed76d07833dff3136f8bceea4cc23/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-2.png" target="_blank">6c38059</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
</tr>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-2.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>plot(ce_temps_yr_ts, main = paste(&quot;Temps with LL est. and SCB for bandwidth:&quot;, round(b_final_2, 3)))
lines(as.numeric(years), ce_temps_tilde_2, lwd = 2, lty = 1, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_UB_2, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_LB_2, lwd = 2, lty = 2, col = &quot;coral&quot;)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-6-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-3">
Past versions of unnamed-chunk-6-3.png
</button>
</p>
<div id="fig-unnamed-chunk-6-3" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/6c380590584ed76d07833dff3136f8bceea4cc23/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-3.png" target="_blank">6c38059</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
</tr>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-3.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>plot(ce_temps_yr_ts, main = paste(&quot;Temps with LL est. and SCB for bandwidth:&quot;, round(b_final_3, 3)))
lines(as.numeric(years), ce_temps_tilde_3, lwd = 2, lty = 1, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_UB_3, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_LB_3, lwd = 2, lty = 2, col = &quot;coral&quot;)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-6-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-4">
Past versions of unnamed-chunk-6-4.png
</button>
</p>
<div id="fig-unnamed-chunk-6-4" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/6c380590584ed76d07833dff3136f8bceea4cc23/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-4.png" target="_blank">6c38059</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
</tr>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-4.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>plot(ce_temps_yr_ts, main = paste(&quot;Temps with LL est. and SCB for bandwidth:&quot;, round(b_final_4, 3)))
lines(as.numeric(years), ce_temps_tilde_4, lwd = 2, lty = 1, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_UB_4, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_LB_4, lwd = 2, lty = 2, col = &quot;coral&quot;)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-6-5.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-5">
Past versions of unnamed-chunk-6-5.png
</button>
</p>
<div id="fig-unnamed-chunk-6-5" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/6c380590584ed76d07833dff3136f8bceea4cc23/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-6-5.png" target="_blank">6c38059</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-06
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</div>
<div id="estimating-gamma0-with-eq-25" class="section level2">
<h2>Estimating <span class="math inline">\(\gamma(0)\)</span> with Eq (25) <br></h2>
<pre class="r"><code>kn_thm3_1 = round(length(ce_temps_yr_ts)^(5/8))
kn_thm3_2 = round(length(ce_temps_yr_ts)^(1/3))

breaks_kn_1 = c(seq(1, length(ce_temps_yr_ts), by = kn_thm3_1), length(ce_temps_yr_ts))
breaks_kn_2 = c(seq(1, length(ce_temps_yr_ts), by = kn_thm3_2), length(ce_temps_yr_ts))

df_Am_1 = df_temps_yr %&gt;% 
  mutate(idx = seq(1, length(ce_temps_yr_ts), 1)) %&gt;% 
  mutate(m = cut(idx, breaks = breaks_kn_1, labels = FALSE, include.lowest = TRUE)) %&gt;%
  group_by(m) %&gt;% summarize(A_m = mean(Temp))

df_Am_2 = df_temps_yr %&gt;% 
  mutate(idx = seq(1, length(ce_temps_yr_ts), 1)) %&gt;% 
  mutate(m = cut(idx, breaks = breaks_kn_2, labels = FALSE, include.lowest = TRUE)) %&gt;%
  group_by(m) %&gt;% summarize(A_m = mean(Temp))

sig_hat_1_Am_1 = sqrt(pi*kn_1)/(2*(length(breaks_kn_1)-1))*sum(abs(df_Am_1$A_m - lag(df_Am_1$A_m, 1)), na.rm = TRUE)

q3_norm = qnorm(p = 0.75, 0, 1)
sig_hat_2_Am_1 = sqrt(kn_1/(2*q3_norm))*median(abs(df_Am_1$A_m - lag(df_Am_1$A_m, 1)), na.rm = TRUE)

sig_hat_3_Am_2 = sqrt(pi*kn_2/(2*(length(breaks_kn_2)-1)))*sqrt(sum(abs(df_Am_2$A_m - lag(df_Am_2$A_m, 1))^2, na.rm = TRUE))</code></pre>
<p>Notes/Q’s: <br> - Applying Thm 3, we use <span class="math inline">\(k_n\)</span> of 360^(5/8) for <span class="math inline">\(\hat\sigma_1\)</span> and <span class="math inline">\(\hat\sigma_2\)</span>. We use <span class="math inline">\(k_n\)</span> of 360^(1/3) for <span class="math inline">\(\hat\sigma_3\)</span>. - The values are 0.573, 0.466, and 2.238 respectively. - <span class="math inline">\(\hat\sigma\)</span> estimate with spectral density vs Equations (25) are fairly different. Some are larger than spectral density estimated sigma_hat of 0.538. Some are smaller? Is my calc for variance estimate with sdf incorrect? <br> - Why are these three estimates so different from each other? Perhaps not enough sample size for asymptotic? <br> - Why are all 3 sigma hats also so different? sigma hat 2 sigma_hat seems closest to spectral density, but still larger. <br> - Instead of simple average for calculating <span class="math inline">\(A_i&#39;s\)</span>, should we be looking at residuals of local linear estimates?</p>
<p><br></p>
</div>
<div id="re-calc-scbs-with-eq-25" class="section level2">
<h2>Re-Calc SCBs with Eq (25) <br></h2>
<p>Notes/Q’s: <br> - We re-calculate the 95% SCBs using the local linear estimate with supposed Ruppert optimal bandwidth of 0.05 (final optimal bnwidth of 0.1. <br> - Note a large discrepancy in empirical coverage rates of the 95% SCBs driven by the difference in estimated variances based on the 3 methods in Equation (25). <br> - ** Empirical coverage ranges anywhere from 85% to 99%. ** <br> - We plot the three SCBs as well for comparison.</p>
<pre class="r"><code>interval_95_1_Am = quantile(sup_mus_boot_2, 0.95)*sqrt(sig_hat_1_Am_1)
interval_95_2_Am = quantile(sup_mus_boot_2, 0.95)*sqrt(sig_hat_2_Am_1)
interval_95_3_Am = quantile(sup_mus_boot_2, 0.95)*sqrt(sig_hat_3_Am_2)

temps_UB_1_Am = ce_temps_tilde_2 + interval_95_1_Am
temps_LB_1_Am = ce_temps_tilde_2 - interval_95_1_Am
temps_UB_2_Am = ce_temps_tilde_2 + interval_95_2_Am
temps_LB_2_Am = ce_temps_tilde_2 - interval_95_2_Am
temps_UB_3_Am = ce_temps_tilde_2 + interval_95_3_Am
temps_LB_3_Am = ce_temps_tilde_2 - interval_95_3_Am


plot(ce_temps_yr_ts, ylim = c(6.5, 13), 
     main = paste(&quot;Temps with LL est. and SCBss for bandwidth:&quot;, round(b_final_1, 3)))
lines(as.numeric(years), ce_temps_tilde_2, lwd = 2, lty = 1, col = &quot;black&quot;)
legend(&quot;topleft&quot;, legend = c(&quot;sigma_1&quot;, &quot;sigma_2&quot;, &quot;sigma_3&quot;), 
       col = c(&quot;coral&quot;, &quot;chartreuse&quot;, &quot;deepskyblue&quot;), lwd = c(2,2,2), lty = c(2,2,2))
lines(x = as.numeric(years), y = temps_UB_1_Am, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_LB_1_Am, lwd = 2, lty = 2, col = &quot;coral&quot;)
lines(x = as.numeric(years), y = temps_UB_2_Am, lwd = 2, lty = 2, col = &quot;chartreuse&quot;)
lines(x = as.numeric(years), y = temps_LB_2_Am, lwd = 2, lty = 2, col = &quot;chartreuse&quot;)
lines(x = as.numeric(years), y = temps_UB_3_Am, lwd = 2, lty = 2, col = &quot;deepskyblue&quot;)
lines(x = as.numeric(years), y = temps_LB_3_Am, lwd = 2, lty = 2, col = &quot;deepskyblue&quot;)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-8-1">
Past versions of unnamed-chunk-8-1.png
</button>
</p>
<div id="fig-unnamed-chunk-8-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-8-1.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>paste(&quot;empirical coverage sigma sdf:&quot;, 
      round(length(which(ce_temps_yr_ts &lt;= temps_UB_2 &amp; ce_temps_yr_ts &gt;= temps_LB_2))/360, 3))</code></pre>
<pre><code>[1] &quot;empirical coverage sigma sdf: 0.703&quot;</code></pre>
<pre class="r"><code>paste(&quot;empirical coveragae sigma 1 (Eq 25):&quot;, 
      round(length(which(ce_temps_yr_ts &lt;= temps_UB_1_Am &amp; ce_temps_yr_ts &gt;= temps_LB_1_Am))/360, 3))</code></pre>
<pre><code>[1] &quot;empirical coveragae sigma 1 (Eq 25): 0.867&quot;</code></pre>
<pre class="r"><code>paste(&quot;empirical coveragae sigma 2 (Eq 25):&quot;, 
      round(length(which(ce_temps_yr_ts &lt;= temps_UB_2_Am &amp; ce_temps_yr_ts &gt;= temps_LB_2_Am))/360, 3))</code></pre>
<pre><code>[1] &quot;empirical coveragae sigma 2 (Eq 25): 0.839&quot;</code></pre>
<pre class="r"><code>paste(&quot;empirical coveragae sigma 3 (Eq 25):&quot;, 
      round(length(which(ce_temps_yr_ts &lt;= temps_UB_3_Am &amp; ce_temps_yr_ts &gt;= temps_LB_3_Am))/360, 3))</code></pre>
<pre><code>[1] &quot;empirical coveragae sigma 3 (Eq 25): 0.992&quot;</code></pre>
<p><br> <br> <br></p>
<p>Playground <br></p>
<p>Notes/Q’s: <br> - Thoughts on playing with fake data, like suppose we added 2 degrees Celsius to all temps after 1990, etc.</p>
<pre class="r"><code>ce_temps_yr_ts_fake = ifelse(time(ce_temps_yr_ts) &gt;= 1900, ce_temps_yr_ts + 2, ce_temps_yr_ts)
plot(ce_temps_yr_ts_fake)
lines(lowess(ce_temps_yr_ts_fake, f= 0.1), lwd = 2, col = 2)
lines(lowess(ce_temps_yr_ts_fake), lwd = 2, col = 4)</code></pre>
<p><img src="figure/weather_data_analysis.Rmd/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-9-1">
Past versions of unnamed-chunk-9-1.png
</button>
</p>
<div id="fig-unnamed-chunk-9-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/acloudysun12/SCBs_Exploration/blob/cc3ac7c6857d5cce761d100dab3c767ecc86412e/docs/figure/weather_data_analysis.Rmd/unnamed-chunk-9-1.png" target="_blank">cc3ac7c</a>
</td>
<td>
Adam Sun
</td>
<td>
2020-03-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 3.5.1 (2018-07-02)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 18362)

Matrix products: default

locale:
[1] LC_COLLATE=English_United States.1252 
[2] LC_CTYPE=English_United States.1252   
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] forecast_8.9    fracdiff_1.4-2  tseries_0.10-47 scales_1.0.0   
 [5] forcats_0.3.0   stringr_1.4.0   dplyr_0.8.0.1   purrr_0.3.2    
 [9] readr_1.1.1     tidyr_0.8.1     tibble_2.1.3    ggplot2_3.2.1  
[13] tidyverse_1.2.1 astsa_1.9      

loaded via a namespace (and not attached):
 [1] zoo_1.8-5         tidyselect_0.2.5  urca_1.3-0       
 [4] haven_1.1.2       lattice_0.20-35   colorspace_1.4-1 
 [7] htmltools_0.3.6   yaml_2.2.0        rlang_0.4.0      
[10] pillar_1.4.2      glue_1.3.1        withr_2.1.2      
[13] TTR_0.23-5        modelr_0.1.2      readxl_1.1.0     
[16] quantmod_0.4-15   timeDate_3043.102 munsell_0.5.0    
[19] gtable_0.3.0      workflowr_1.4.0   cellranger_1.1.0 
[22] rvest_0.3.2       evaluate_0.11     knitr_1.20       
[25] lmtest_0.9-37     parallel_3.5.1    curl_3.2         
[28] broom_0.5.0       xts_0.11-2        Rcpp_1.0.2       
[31] backports_1.1.5   jsonlite_1.5      fs_1.2.6         
[34] hms_0.4.2         digest_0.6.21     stringi_1.4.3    
[37] grid_3.5.1        rprojroot_1.3-2   quadprog_1.5-8   
[40] cli_1.1.0         tools_3.5.1       magrittr_1.5     
[43] lazyeval_0.2.2    crayon_1.3.4      whisker_0.3-2    
[46] pkgconfig_2.0.3   xml2_1.2.0        lubridate_1.7.4  
[49] assertthat_0.2.1  rmarkdown_1.10    httr_1.3.1       
[52] rstudioapi_0.8    R6_2.4.0          nnet_7.3-12      
[55] nlme_3.1-137      git2r_0.25.2      compiler_3.5.1   </code></pre>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
